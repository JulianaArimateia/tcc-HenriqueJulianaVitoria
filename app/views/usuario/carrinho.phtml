<head>
    <link rel="stylesheet" href="assets/css/carrinho/style.css">
</head>

<div class="scroll">
    <table class="tabela">
        <thead>
            <tr>
                <td></td>
                <td>Nome do produto</td>
                <td>Descrição</td>
                <td>Preço</td>
                <td class="qtd__coluna">Qtd</td>
            </tr>
        </thead>
        <tbody>
            <?php
            $produtos = $this->view->produtos;
            $carrinho = $this->view->carrinho;
            foreach ($produtos as $produto) {
                foreach ($carrinho as $item) {
                    if ($produto['id'] == $item['id_produtos'] && $_SESSION['id'] == $item['id_usuarios']) {
                        echo "<tr class='produto__carrinho'>";
                        echo "<td><img src='assets/img/produto/" . $produto['imagem'] . "' alt='" . $produto['nome_produto'] . "' class='img__card'></td>";
                        echo "<td>{$produto['nome_produto']}</td>";
                        echo "<td>{$produto['descricao']}</td>";
                        echo "<td>{$produto['valor']}</td>";
                        echo "<td class='qtd__carrinho'>";
                        if ($item['quantidade'] > 1) {
                            echo "<a href='/menosQtdCarrinho?id={$item['id']}'>-</a>";
                        } else {
                            echo "<a href='/menosQtdCarrinho?id={$item['id']}'><img src='assets/img/icons/icons_admin/lixeira.png' width='15px'></a>";
                        }
                        echo "<div class='qtd'>{$item['quantidade']}</div>";
                        if ($item['quantidade'] == $produto['quantidade_produto']) {
                        } else {
                            echo "<a id='mais' href='/maisQtdCarrinho?id={$item['id']}'>+</a>";
                        }

                        echo "</td>";
                        echo "</tr>";
                    }

                    if ($item['quantidade'] == 0) {
                        header('location: /removerCarrinho?id=' . $item['id_produtos'] . '');
                    }
                }
            }
            ?>
        </tbody>
    </table>
</div>

<div class="pagamento">
    <div class="header__pag">
        <h2>Pagamento</h2>
        <select name="metodo" id="metodo">
            <option value="pix">Pix</option>
            <option value="debito">Débito</option>
            <option value="credito">Crédito</option>
        </select>
    </div>
    <div class="corpo__pag">
        <?php

        $valores = [];
        $total = 0;

        $idCarrinho = 0;
        $idProduto = 0;

        foreach ($produtos as $produto) {
            foreach ($carrinho as $item) {
                if ($produto['id'] == $item['id_produtos'] && $_SESSION['id'] == $item['id_usuarios']) {
                    $subtotal = floatval($produto['valor']) * intval($item['quantidade']);
                    $valores[] = $subtotal;


                    $idCarrinho = $item['id'];
                    $idProduto = $produto['id'];
                }
            }
        }

        $total = number_format(array_sum($valores), 2);
        ?>
        <h2 class='valor'>
            Total: R$ <?= number_format($total, 2, ',', '.') ?> </h2>

        <form method='POST' action="/pagamento" enctype='multipart/form-data'>
            <input type='date' name='data_entrega'>
            <input type="hidden" value="<?= $total; ?>" name="valor_produto">
            <input type="hidden" value="<?= $idCarrinho; ?>" name="id_carrinho">
            <input type="hidden" value="<?= $idProduto; ?>" name="id_produto">

            <?php


            if ($total == 0) {
                echo "<a type='submit' href='/' class='voltar__home'>Adicione ao carrinho</a>";
            } else {
                // echo "<button type='submit'  class='btn__pag'>Confirmar compra</button>";

            ?>
                <button type="submit"  class='btn__pag'>Pagamento</button>
            <?php
            };

            echo "</form>";
            ?>
    </div>
</div>